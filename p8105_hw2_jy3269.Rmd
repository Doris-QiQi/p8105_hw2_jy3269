---
title: "p8105_hw2_jy3269"
author: "Jingyi Yao"
date: "`r Sys.Date()`"
output: github_document
---

```{r,warning=FALSE,message=FALSE}
library(tidyverse)
library(readxl)
```


## Problem 1 


### 1. Import csv data
```{r, warning=TRUE,message=FALSE}
data_1 <- read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv",col_types = cols(Route8 = "c", Route9 = "c", Route10 = "c", Route11 = "c")) %>% 
  janitor::clean_names() 

head(data_1)


```


### 2. Clean data
```{r}
transit <- data_1 %>%  
  select(line, station_name, station_latitude,station_longitude, route1:route11, entry, vending, entrance_type, ada) %>% 
  mutate(entry=recode(entry,"YES"= TRUE,"NO"= FALSE))

transit

```

*  Description of the data:
  * the transit data set has : `r ncol(transit)` columns(variables) and `r nrow(transit)` rows
  * the dimenison is : `r dimension(transit)`
  * the variables are : `r names(transit)`


*  data cleaning steps:
  * read in csv and then change the data type from route8 to route11 into character
  * unify variable name format using `janitor::clean_names`
  * select the required columns using `select()` in `dplyr`
  * convert the character values in `entry` column into logical values (TRUE or FALSE) using `mutate()` and `recode()`
  

### 3. How many distinct station?
```{r}
# method 1
tibble(transit$line,transit$station_name) %>% 
  distinct()

```


### 4. ADA compliant
```{r}
transit %>% 
  filter(ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct()

```


### 5. Proportion of entrance without vending
```{r}
proportion <- transit %>% 
  filter(vending == "NO") %>% 
  pull(entry) %>% 
  mean()

proportion

```

### 6. Reform route number and route name
```{r}
transit %>% 
  pivot_longer(
    route1:route11,
    names_to = "route_num",
    values_to = "route") %>% 
  filter(route == "A", ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct()

```




## Problem 2

### 1. Read in Mr. Trash Wheel
```{r}
data_2 <- read_excel("./data/Trash Wheel Collection Data.xlsx",range = "A2:N550") 
# select the range that contains data

head(data_2)

```


### 2. Clean Mr. Trash Wheel
```{r}
mr <- data_2 %>% 
  janitor::clean_names() %>%              # tidy up variable names
  drop_na(dumpster) %>%                   # drop the rows without specific dumpster information
  mutate(sports_balls = as.integer(round(sports_balls,digits = 0)),
         origin = "Mr. Trash Wheel ",.before = "dumpster") %>% 
  unite("ID",origin : dumpster,sep = "")  # a new column named ID to mark the dumpster from Mr.
  
head(mr)

```


### 3. Read in Professor Trash Wheel
```{r}
data_3 <- read_excel("./data/Trash Wheel Collection Data.xlsx",range = "A2:M97",sheet="Professor Trash Wheel")
# select the range that contains data

head(data_3)
```


### 4. Clean Professor Trash Wheel
```{r}
pro <- data_3 %>% 
  janitor::clean_names() %>%             # tidy up variable names
  drop_na(dumpster) %>%                  # drop rows without specific dumpster information
  mutate(year=as.character(year) ,
         origin = "Professor Trash Wheel ",.before = "dumpster") %>% 
  unite("ID",origin : dumpster,sep = "") # a new column to mark the dumpster from professor

head(pro)

```


### 5. Combine the 2 datasets
```{r}
combined_trash <- bind_rows(mr,pro) # use bind_rows() to combine the 2 datasets
head(combined_trash)
tail(combined_trash)

```


### 6. Description:

*  description of the data
  * the dimension of Mr. Trash Wheel is `r dim(mr)`, containing `r nrow(mr)` rows and `r ncol(mr)` columns
  * variables in Mr. Trash Wheel are `r names(mr)`
  * the key variables in Mr. Trash Wheel are `r pull(mr, 5:13)`
  * the dimension of Professor Trash Wheel is `r dim(pro)`, containing `r nrow(pro)` rows and `r ncol(pro)` columns
  * variables in Professor Trash Wheel are `r names(pro)`
  * key variables in Professor Trash Wheel are `r pull(pro,5:12)`
  
*  Answer to the questions
  * 1. What was the total weight of trash collected by Professor Trash Wheel? 
  * the total weight of trash collected by Professor Trash Wheel is `r sum(pull(pro,weight_tons))`
  * 2. What was the total number of sports balls collected by Mr. Trash Wheel in 2020?
  * the total number of sports balls collected by Mr. Trash Wheel in 2020 is `r sum(pull(filter(mrtrash,year==2020),sports_balls))`




## Problem 3

### 1. Read in the 3 csv files
```{r}
pols_month <- read.csv("./data/pols-month.csv")
head(pols_month)

unemployment <- read.csv("./data/unemployment.csv")
head(unemployment)

snp <- read.csv("./data/snp.csv")
head(snp)


```

### 2. Clean the pol-month dataset
```{r}
pols <- pols_month %>% 
  janitor::clean_names() %>% 
  separate(mon,into=c("year","month","day")) %>%      # separate the date
  mutate(month = month.abb[as.numeric(month)],        # change name of month into character
         president=ifelse(prez_gop==0,'dem','gop'),   # president takes dem when prez_gop = 0  
         year=as.numeric(year)) %>%                   # change the format of year into dbl
  select(year,month,president,everything(),-prez_gop,-prez_dem,-day) 
  # put year month and president at the front and delete 3 columns specified in the requirement

head(pols)

```

### 3. Clean the snp dataset
```{r}
SNP <- snp %>% 
  janitor::clean_names() %>% 
  separate(date,into = c("month","day","year"),sep="/") %>% # separate the date
  mutate(year = as.numeric(year),                           # change year into dbl
         year=ifelse(year<=20,year+2000,year+1900),         # change year into 4 digits
         month = month.abb[as.numeric(month)]) %>%          # change month into character
  select(year,month,close)                                  # set year and month as leading columns


head(SNP)
tail(SNP)

```

### 4. Clean the unemployment datset
```{r}
unemploy <- unemployment %>% 
  pivot_longer(                 # change from wide to longer
    Jan:Dec,
    names_to="month",
    values_to = "unemployment_percentage") %>% 
  rename(year=Year) %>%         # change the name of Year into year to unify with other datasets
  mutate(year= as.numeric(year)) %>% 
  janitor::clean_names()

unemploy

```

### 5. Join the datasets
```{r}
pols_snp <- full_join(pols,SNP)
pols_snp

pols_snp_unemploy <- full_join(pols_snp,unemploy)
pols_snp_unemploy

```






